{{- /* Disqus Comments with Theme Support */ -}}
{{- if not .Params.disableComments }}
<div id="disqus_thread"></div>
<script>
    // Detect current theme
    function getDisqusTheme() {
        return document.body.classList.contains('dark') || 
               document.documentElement.getAttribute('data-theme') === 'dark' 
               ? 'dark' : 'light';
    }
    
    // Disqus configuration
    var disqus_config = function () {
        this.page.url = '{{ .Permalink }}';
        this.page.identifier = '{{ .File.ContentBaseName }}';
        this.page.title = '{{ .Title }}';
        
        // Set Disqus color scheme based on theme
        this.colorScheme = getDisqusTheme();
    };
    
    // Load Disqus
    (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://{{ .Site.DisqusShortname }}.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    
    // Reload Disqus when theme changes
    if (document.getElementById('theme-toggle')) {
        document.getElementById('theme-toggle').addEventListener('click', function() {
            setTimeout(function() {
                if (window.DISQUS) {
                    DISQUS.reset({
                        reload: true,
                        config: function() {
                            this.page.url = '{{ .Permalink }}';
                            this.page.identifier = '{{ .File.ContentBaseName }}';
                            this.page.title = '{{ .Title }}';
                            this.colorScheme = getDisqusTheme();
                        }
                    });
                }
            }, 100);
        });
    }
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
{{- end }}
